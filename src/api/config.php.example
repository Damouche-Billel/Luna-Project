<?php
/**
 * Database Configuration for LUNA Newsletter System
 * SQL Server LocalDB Connection
 */

// Brevo API Configuration
define('BREVO_API_KEY', 'your-brevo-api-key-here');
define('BREVO_API_PASSWORD', 'your-brevo-api-password-here');

// Database connection settings
define('DB_SERVER', '(localdb)\MSSQLLocalDB');
define('DB_NAME', 'Luna');
define('DB_USERNAME', ''); // Windows Authentication
define('DB_PASSWORD', ''); // Windows Authentication

// Connection options
$connectionOptions = array(
    "Database" => DB_NAME,
    "TrustServerCertificate" => true,
    "MultipleActiveResultSets" => false,
    "Encrypt" => false
);

/**
 * Get database connection
 * @return resource|false Connection resource or false on failure
 */
function getDBConnection() {
    global $connectionOptions;
    
    $conn = sqlsrv_connect(DB_SERVER, $connectionOptions);
    
    if ($conn === false) {
        error_log("Database connection failed: " . print_r(sqlsrv_errors(), true));
        return false;
    }
    
    return $conn;
}

/**
 * Close database connection
 * @param resource $conn
 */
function closeDBConnection($conn) {
    if ($conn) {
        sqlsrv_close($conn);
    }
}

// Error reporting settings (debug)
ini_set('display_errors', 1);
error_reporting(E_ALL);

// CORS headers for API access
header('Content-Type: application/json; charset=utf-8');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type');

// Handle preflight OPTIONS request
if ($_SERVER['REQUEST_METHOD'] === 'OPTIONS') {
    http_response_code(200);
    exit();
}
?>
